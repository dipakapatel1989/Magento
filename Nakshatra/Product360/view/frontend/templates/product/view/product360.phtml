<?php
/** @var \Nakshatra\Product360\Block\Product\View\Product360 $block */

// Add debugging information
echo "<!-- Product360 Template Debug Start -->";
echo "<!-- Module enabled: " . ($block->getProduct360Helper()->isEnabled() ? 'Yes' : 'No') . " -->";

$product = $block->getProduct();
if ($product) {
    echo "<!-- Product ID: " . $product->getId() . " -->";
    echo "<!-- Enable 360 View attribute: " . ($product->getData('enable_360_view') ? 'Yes' : 'No') . " -->";
    echo "<!-- Number of 360 images: " . count($block->get360Images()) . " -->";
} else {
    echo "<!-- No product found -->";
}

if (!$product->getId()=='2043') {
    if (!$block->canShow()) {
        echo "<!-- Product360 Widget: Cannot show (conditions not met) -->";
        return;
    }
}
$images = $block->get360Images();
echo $block->escapeUrl($images[0]) ;
echo "<!-- Product360 Widget: Rendering -->";
?>

<div class="product-360-viewer" id="product-360-viewer">
    <div class="product-360-container">
        <div class="product-360-images">
            <?php $images = $block->get360Images(); ?>
            <?php if (!empty($images)): ?>
                <img id="product-360-current-image"
                     src="<?= $block->escapeUrl($images[0]) ?>"
                     alt="<?= $block->escapeHtml(__('360° Product View')) ?>" />
            <?php else: ?>
                <div>No 360° images available</div>
            <?php endif; ?>
        </div>

        <?php if ($block->getConfig()['showControls']): ?>
            <div class="product-360-controls">
                <button type="button" class="btn-360-play" id="btn-360-play">
                    <span><?= $block->escapeHtml(__('Play')) ?></span>
                </button>
                <button type="button" class="btn-360-pause" id="btn-360-pause" style="display:none;">
                    <span><?= $block->escapeHtml(__('Pause')) ?></span>
                </button>
            </div>
        <?php endif; ?>
    </div>
</div>

<script type="text/x-magento-init">
    {
        "#product-360-viewer": {
            "Nakshatra_Product360/js/product-360-viewer": <?= /* @noEscape */ $block->getJsonConfig() ?>
    }
}
</script>

<style>
    .product-360-viewer {
        margin: 20px 0;
        text-align: center;
        border: 2px solid red; /* Temporary debug border */
    }
    .product-360-container {
        display: inline-block;
        position: relative;
    }
    .product-360-images img {
        max-width: 100%;
        height: auto;
    }
    .product-360-controls {
        margin-top: 10px;
    }
    .product-360-controls button {
        margin: 0 5px;
        padding: 8px 16px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
</style>

<!-- Product360 Template Debug End -->
